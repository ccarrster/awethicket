<!DOCTYPE html>
<html>
<head>
<title>Awe Thicket</title>
<style>

</style>
</head>
<body>
<script src="jquery-3.3.1.min.js"></script>
<script>
    var numberOfPlayers = null;
    var firstPlayer = null;
    var mushroomBoards = [];
    var crateNumbers = [1, 2, 3, 4, 4];
    var mushroomNames = ['Girolles', 'Morels', 'Boletes', 'Parasol'];
    var playerColors = ['Blue', 'Green', 'Purple', 'Red', 'Orange'];
    var players = [];
    var currentPlayer = null;
    var scores = [1, 3, 5, 7];
    var informationFlipDeck = null;
    var winners = null;
    var startSharePlayer = null;
    

    class player{
        constructor(inPlayerIndex){
            this.playerIndex = inPlayerIndex;
            this.availableCrates = null;
            this.maxAvailableCrates = null;
            this.mushrooms = [0, 0, 0, 0];
            this.informationPieces = [];
            this.points = 0;
            this.skipped = null;
        }
    }
    class mushroomBoard{
        constructor(inMushroomType, inNumPlayers){
            this.mushroomType = inMushroomType;
            this.crates = [null, null, null, null, null];
            this.information = null;
            this.mushroomQuantity = 0;
            this.sharedInformation = [];
            if(inNumPlayers == 2){
                this.mushroomQuantity = 8;
            } else if(inNumPlayers == 3){
                this.mushroomQuantity = 10;
            } else if(inNumPlayers == 4){
                this.mushroomQuantity = 12;
            } else if(inNumPlayers == 5){
                this.mushroomQuantity = 14;
            } else {
                alert('This is the wrong number of players. Between 2 and 5 please.');
            }
        }
    }
    class information{
        constructor(){
            this.mushroomType = null;
            this.pointValue = null;
        }
    }
    class informationDeck{
        constructor(){
            this.informationPieces = [];
        }
    }
    function isGameOver(){
        var emptyBoardCount = 0;
        for(var i = 0; i < mushroomBoards.length; i++){
            var currentMushroomBoard = mushroomBoards[i];
            if(currentMushroomBoard.mushroomQuantity == 0){
                emptyBoardCount += 1;
            }
        }
        if(emptyBoardCount > 1){
            return true;
        } else {
            return false;
        }
    }

    function getRandomInt(max) {
        return Math.floor(Math.random() * max);
    }

    function gameSetup(inNumPlayers){
        var totalInformationDeck = new informationDeck();
        for(var mushroomType = 0; mushroomType < 4; mushroomType++){
            var mushroomInformationDeck = new informationDeck();
            for(var i = 0; i < scores.length; i++){
                var mushroomInformation = new information();
                mushroomInformation.mushroomType = mushroomType;
                mushroomInformation.pointValue = scores[i];
                mushroomInformationDeck.informationPieces.push(mushroomInformation);
            }
            var randomInformation = getRandomInt(4);
            var chosenInfo = mushroomInformationDeck.informationPieces.splice(randomInformation, 1);

            currentMushroomBoard = new mushroomBoard(mushroomType, inNumPlayers);
            currentMushroomBoard.information = chosenInfo[0];
            mushroomBoards.push(currentMushroomBoard);
            for(var j = 0; j < mushroomInformationDeck.informationPieces.length; j++){
                totalInformationDeck.informationPieces.push(mushroomInformationDeck.informationPieces[j]);
            }
        }

        for(var playerIndex = 0; playerIndex < inNumPlayers; playerIndex++){
            var newPlayer = new player(playerIndex);
            newPlayer.maxAvailableCrates = 5;
            newPlayer.availableCrates = newPlayer.maxAvailableCrates;
            newPlayer.skipped = false;

            if(inNumPlayers == 2){
                for(var k = 0; k < 4; k++){
                    var info = takeRandomInformation(totalInformationDeck);
                    newPlayer.informationPieces.push(info);
                }
                //Left over cards
                informationFlipDeck = totalInformationDeck;
            } else if(inNumPlayers == 3){
                for(var k = 0; k < 4; k++){
                    var info = takeRandomInformation(totalInformationDeck);
                    newPlayer.informationPieces.push(info);
                }
            } else if(inNumPlayers == 4){
                for(var k = 0; k < 3; k++){
                    var info = takeRandomInformation(totalInformationDeck);
                    newPlayer.informationPieces.push(info);
                }
            } else if(inNumPlayers == 5){
                for(var k = 0; k < 2; k++){
                    var info = takeRandomInformation(totalInformationDeck);
                    newPlayer.informationPieces.push(info);
                }
                //Last cards are not used
            }
            players.push(newPlayer);
        }
        firstPlayer = 0;
        currentPlayer = firstPlayer;
    }

    function takeRandomInformation(inInformationDeck){
        var randomInformation = getRandomInt(inInformationDeck.informationPieces.length);
        var chosenInfo = inInformationDeck.informationPieces.splice(randomInformation, 1);
        return chosenInfo[0];
    }

    function choosePlayers(inPlayerNumber){
        appendLog('Starting new game with ' + inPlayerNumber + ' players.');
        $("#setup").html('');
        gameSetup(inPlayerNumber);
        refreshMushroomBoards();
        refreshPlayerBoards();
        showSecretsActions();
        gameLoop();
    }

    function appendLog(text){
        $('#gamelogtext').val($('#gamelogtext').val() + text + "\n");
        $('#gamelogtext').scrollTop($('#gamelogtext').prop("scrollHeight"));
    }

    function refreshMushroomBoards(){
        var mushroomBoardString = "";
        for(var i = 0; i < mushroomBoards.length; i++){
            mushroomBoardString += "<div style='position:relative; border: solid black 4px; margin: 5px; background-color: #eee; display: inline-block;'>";
            var mushroomBoard = mushroomBoards[i];
            mushroomBoardString += "<img src='" + getMushroomName(mushroomBoard.mushroomType) + ".png' alt='" + getMushroomName(mushroomBoard.mushroomType) + " mushroom'>";
            var cratesString = "<div>";
            for(var j = 0; j < mushroomBoard.crates.length; j++){
                var cratePlayer = mushroomBoard.crates[j];
                var crateCount = getCrateCost(j);
                var crateImages = '';
                for(var m = 0; m < crateCount; m++){
                    crateImages += "<img id='cratemushroomsmall_"+i+"_"+j+"_"+m+"' style='max-width: 20px; position: absolute; left: "+m*20+"px; background-color: "+getPlayerColor(cratePlayer)+";' src='basket.png' alt='basket'>";
                }
                cratesString += "<div style='position: relative;'>" + crateImages + " " + crateCount + " " + getPlayerColor(cratePlayer) + " <div style='display: inline' id='buymushroom_" + i + "_" + j + "'></div></div>";
            }
            cratesString += "</div>";
            var informationString = "<div>Shared Value: ";
            mushroomBoard.sharedInformation.sort(pointSort);
            for(var k = 0; k < mushroomBoard.sharedInformation.length; k++){
                var sharedValue = mushroomBoard.sharedInformation[k].pointValue;
                informationString += sharedValue;
                if(k != mushroomBoard.sharedInformation.length - 1){
                    informationString += ", ";
                }
            }
            informationString += "</div>";
            var quantityImages = '';
            for(var l = 0; l < mushroomBoard.mushroomQuantity; l++){
                quantityImages += "<img id='mushroomsmall_"+i+"_"+l+"' style='position:absolute; left: "+20*l+"px; max-width: 20px;' src='" + getMushroomName(mushroomBoard.mushroomType) + ".png' alt='" + getMushroomName(mushroomBoard.mushroomType) + " mushroom'>";
            }
            mushroomBoardString += getMushroomName(mushroomBoard.mushroomType)+" "+mushroomBoard.mushroomQuantity+" " + quantityImages + " " + cratesString + informationString;
            if(isGameOver()){
                mushroomBoardString += "<div>Value: " + mushroomBoard.information.pointValue + "</div>";
            }
            mushroomBoardString += "</div>";
            mushroomBoardString += '</div>';
        }
        $("#mushroomBoards").html(mushroomBoardString);
    }

    function pointSort(a, b){
        return a.pointValue - b.pointValue;
    }

    function getCrateCost(index){
        return crateNumbers[index];
    }

    function getMushroomName(typeIndex){
        return mushroomNames[typeIndex];
    }

    function getPlayerColor(playerIndex){
        if(playerIndex == null){
            return 'Empty';
        } else {
            return playerColors[playerIndex];
        }
    }

    function refreshPlayerBoards(){
        var playerBoardString = '';
        for(var i = 0; i < players.length; i++){
            var borderStyle = 'solid';
            if(i == currentPlayer){
                borderStyle = 'dashed';
            }
            var playerString = '<div style="position: relative; margin: 5px; background-color: #eee; border: ' + borderStyle + ' ' + getPlayerColor(i) + ' 4px; display: inline-block;">' + getPlayerColor(i);
            var currentPlayerObject = players[i];
            for(var j = 0; j < currentPlayerObject.mushrooms.length; j++){

                var mushroomImages = '';
                for(var m = 0; m < currentPlayerObject.mushrooms[j]; m++){
                    mushroomImages += "<img style='max-width: 20px;' src='" + getMushroomName(j) + ".png' alt='" + getMushroomName(j) + " mushroom'>";
                }
                playerString += '<div>' + currentPlayerObject.mushrooms[j] + ' X ' + getMushroomName(j) + mushroomImages +'<div id="mushroomsmallplayer_'+i+'_'+j+'" style="display: inline-block; position: absolute; left: '+20*j+'px;"></div></div>';
            }
            var crateImages = '';
            for(var k = 0; k < currentPlayerObject.availableCrates; k++){
                crateImages += "<img id='crateplayersmall_"+i+"_"+k+"' style='position:absolute; left: "+20*k+"px; max-width: 20px; background-color: "+getPlayerColor(i)+";' src='basket.png' alt='basket'>";
            }

            playerString += '<div style="position: relative;">'+currentPlayerObject.availableCrates+' X Crates '+ crateImages +'</div>';
            playerString += '<div>Turn skipped '+currentPlayerObject.skipped+'</div>';
            playerString += '<div>First Player '+ (i == firstPlayer) +'</div>';
            
            if(isGameOver()){
                playerString += '<div>Points: ' + currentPlayerObject.points + '</div>';
            }
            playerString += '</div>';
            playerBoardString += playerString;
        }
        $("#playerBoards").html(playerBoardString);
    } 

    function gameLoop(){
        appendLog('Picking Mushrooms Phase.');
        showTurn();
        showActions();
        refreshPlayerBoards();
    }

    function showTurn(){
        $("#current").html("Current Turn: " + getPlayerColor(currentPlayer));
    }

    function getNextPlayer(){
        currentPlayer += 1;
        if(currentPlayer >= players.length){
            currentPlayer = 0;
        }
    }

    function clearActions(){
        //Temp probably just have different actions
        $("#actions").html('');
    }
    
    function showActions(){
        appendLog(getPlayerColor(currentPlayer) + ' turn to pick mushrooms.');
        var actionString = '<div>Game Phase: Picking Mushrooms</div>';
        var currentPlayerObject = players[currentPlayer];
        if(currentPlayerObject.skipped == true){
            pass();
        } else {
            var crates = currentPlayerObject.availableCrates;
            var hasOptions = false;
            for(var i = 0; i < mushroomBoards.length; i++){
                var currentMushroomBoard = mushroomBoards[i];
                if(currentMushroomBoard.mushroomQuantity > 0){
                    var cost = getMushroomCost(currentMushroomBoard);
                    var mushroomIndex = getMushroomIndex(currentMushroomBoard);
                    //Not just cost but index now
                    if(cost != null && crates >= cost){
                        hasOptions = true;
                        var basketString = '';
                        for(var j = 0; j < cost; j++){
                            basketString += '<img style="max-width: 50px; background-color: '+getPlayerColor(currentPlayer)+';" src="basket.png" alt="basket">';
                        }
                        //actionString += '<div>'+"<img style='max-width: 50px;' src='" + getMushroomName(currentMushroomBoard.mushroomType) + ".png' alt='" + getMushroomName(currentMushroomBoard.mushroomType) + " mushroom'>"+'<input style="margin: 5px;" type="button" value="Buy a ' + getMushroomName(currentMushroomBoard.mushroomType) + ' for ' + cost + ' crates" onclick="buyMushroom('+i+', '+cost+')">'+basketString+'</div>';
                        $("#buymushroom_"+i+"_"+mushroomIndex).html('<input style="margin: 5px;" type="button" value="Buy a ' + getMushroomName(currentMushroomBoard.mushroomType) + ' for ' + cost + ' crates" onclick="buyMushroom('+i+', '+cost+')">');
                    }
                }
            }
            actionString += '<input style="margin: 5px;" type="button" value="Pass" onclick="pass()">';
            $("#actions").html(actionString);
            if(hasOptions == false){
                appendLog(getPlayerColor(currentPlayer) + ' automatically passes for Picking Mushrooms.');
                pass();
            }
        }
    }

    function omnomEats(from, to){
        var elementFrom = document.getElementById(from);
        var rectFrom = elementFrom.getBoundingClientRect();
        var elementTo = document.getElementById(to);
        var rectTo = elementTo.getBoundingClientRect();
        var styleElement = document.getElementById('customAnimation');
        var yChange = rectFrom.top - rectTo.top;
        //Not sure why minus 1
        var yChange = yChange * -1;
        var xChange = rectTo.left - rectFrom.left;
        //Not sure why + 50
        var xChange = xChange + 50;
        console.log(rectTo.left);
        console.log(rectFrom.left);
        styleElement.innerHTML = '	.nomnomEat{\
        animation:mysecond 1s;\
        -webkit-animation:mysecond 1s; /* Safari and Chrome */\
        }\
    \
        @keyframes mysecond\
        {\
        0%   {left:0px; top:0px;}\
        50%   {left:'+xChange+'px; top:'+yChange+'px;}\
        100% {left:0px; top:0px;}\
        }\
    \
        @-webkit-keyframes mysecond /* Safari and Chrome */\
        {\
        0%   {left:0px; top:0px;}\
        50% {left:'+xChange+'px; top:'+yChange+'px;}\
        100% {left:0px; top:0px;}\
        }';
        document.getElementById(from).className = "nomnomEat";
        eatFrom = from;
        //foodToClear.push(eatFrom);
        //setTimeout("clearFood()",1100);
    }

    function getMushroomCost(inMushroomBoard){
        for(var i = 0; i < inMushroomBoard.crates.length; i++){
            var cratePlayer = inMushroomBoard.crates[i];
            if(cratePlayer == null){
                return getCrateCost(i);
            }
        }
        return null;
    }

    function getMushroomIndex(inMushroomBoard){
        for(var i = 0; i < inMushroomBoard.crates.length; i++){
            var cratePlayer = inMushroomBoard.crates[i];
            if(cratePlayer == null){
                return i;
            }
        }
        return null;
    }

    function buyMushroom(mushroomType, cost){
        //xxx
        //May need crate index
        //mushroom type, crate index, crate number
        //cratemushroomsmall_"+i+"_"+j+"_"+m+


        var playerIdString = "mushroomsmallplayer_"+currentPlayer+"_"+mushroomType;
        var mushroomIdString = "mushroomsmall_"+mushroomType+"_0";
        
        var mushroomCrateIdString = "cratemushroomsmall_"+mushroomType+"_0_0";
        var playerCrateIdString = "crateplayersmall_"+currentPlayer+"_"+mushroomType;
        omnomEats(playerCrateIdString, mushroomCrateIdString);
        setTimeout(() => {  
           omnomEats(mushroomIdString, playerIdString);
            setTimeout(() => {  
                appendLog(getPlayerColor(currentPlayer) + ' picked a ' + getMushroomName(mushroomType) + ' with ' + cost + ' crates.');
                var mushroomBoard = mushroomBoards[mushroomType];
                var currentPlayerObject = players[currentPlayer];
                currentPlayerObject.availableCrates -= cost;
                putCratesOnMushroomBoard(mushroomBoard, currentPlayer);
                mushroomBoard.mushroomQuantity -= 1;
                currentPlayerObject.mushrooms[mushroomType] += 1;
                setTimeout(() => {  
                    getNextPlayer();
                    refreshMushroomBoards();
                    refreshPlayerBoards();
                    showTurn();
                    showActions();
                }, 1400);
            }, 1400);
        }, 1400);
    }

    

    function pass(){
        appendLog(getPlayerColor(currentPlayer) + ' passed picking mushrooms.');
        players[currentPlayer].skipped = true;
        getNextPlayer();
        refreshMushroomBoards();
        var skippedPlayerCount = 0;
        for(var i = 0; i < players.length; i++){
            if(players[i].skipped == true){
                skippedPlayerCount += 1;
            }
        }
        refreshPlayerBoards();
        if(skippedPlayerCount == players.length){
            appendLog('Bonus mushrooms.');
            getBonus();
            clearCrates();
            refreshMushroomBoards();
            refreshPlayerBoards();
            clearActions();
            if(isGameOver()){
                appendLog('The game is over.');
                $('#secrets').html('');
                //Points
                for(var l = 0; l < mushroomBoards.length; l++){
                    var mushroomValue = mushroomBoards[l].information.pointValue;
                    appendLog(getMushroomName(l) + ' is worth ' + mushroomValue + ' points.');
                }

                for(var i = 0; i < players.length; i++){
                    var player = players[i];
                    player.points = 0;
                    var playerTotalMushroomCount = 0;
                    for(var j = 0; j < player.mushrooms.length; j++){
                        var mushroomCount = player.mushrooms[j];
                        playerTotalMushroomCount += mushroomCount;
                        var mushroomType = j;
                        var mushroomValue = mushroomBoards[j].information.pointValue;
                        player.points += mushroomCount * mushroomValue;
                    }
                    appendLog(getPlayerColor(i) + ' has ' + player.points + ' points and ' + playerTotalMushroomCount + ' total mushrooms.');
                }
                //Winner and Ties
                winners = [];
                var maxScore = 0;
                var maxCount = 0;
                for(var k = 0; k < players.length; k++){
                    var playerObject = players[k]
                    var sumMushrooms = playerObject.mushrooms.reduce((partialSum, a) => partialSum + a, 0);
                    //More Points
                    if(playerObject.points > maxScore){
                        winners = [k];
                        maxScore = playerObject.points;
                        maxCount = sumMushrooms;
                    //Tie
                    } else if(playerObject.points == maxScore){
                        //More mushrooms
                        if(sumMushrooms > maxCount){
                            winners = [k];
                            maxCount = sumMushrooms;
                        } else if(sumMushrooms == maxCount) {
                            //Same mushroom count
                            winners.push(k);
                        }
                    }
                }
                //winners
                showWinners(maxScore, maxCount);
                refreshPlayerBoards();
                refreshMushroomBoards();
                showRestartOptions();
            } else {
                appendLog('Knowledge Swap Phase.');
                startSharePlayer = currentPlayer;
                showShareOptions();
            }
        } else {
            showTurn();
            showActions();
        }
    }

    function showRestartOptions(){
        $('#actions').html('<input type="button" style="margin: 5px;" value="Start a new game" onclick="showPlayerOptions()">');
    }

    function showPlayerOptions(){

        //reset globals
        numberOfPlayers = null;
        firstPlayer = null;
        mushroomBoards = [];
        players = [];
        currentPlayer = null;
        informationFlipDeck = null;
        winners = null;
        startSharePlayer = null;

        //reset view
        var playerString = '<form> <input type="button" style="margin: 5px;" value="2 Players" onclick="choosePlayers(2);"> <input style="margin: 5px;" type="button" value="3 Players" onclick="choosePlayers(3);"> <input style="margin: 5px;" type="button" value="4 Players" onclick="choosePlayers(4);"> <input style="margin: 5px;" type="button" value="5 Players" onclick="choosePlayers(5);"> </form>';
        $('#setup').html(playerString);
        $('#mushroomBoards').html('');
        $('#playerBoards').html('');
        $('#current').html('');
        $('#winners').html('');
        $('#gamelogtext').val('');
        $('#actions').html('<div>Game Phase: Pick number of players</div>');
    }

    function showShareOptions(){   
        appendLog(getPlayerColor(currentPlayer) + ' turn to Knowledge Swap.');
        showTurn();
        var shareString = '<div>Game Phase: Knowledge Swap</div>';
        var currentPlayerObject = players[currentPlayer];
        if(currentPlayerObject.maxAvailableCrates < 7){
            var informationPieces = currentPlayerObject.informationPieces;
            for(var i = 0; i < informationPieces.length; i++){
                shareString += '<input type="button" style="margin: 5px;" value="Share Information card ' + (i + 1) + '" onclick="share('+i+')">';
            }
            shareString += '<input type="button" style="margin: 5px;" value="Pass" onclick="passShare()">';
            $('#actions').html(shareString);
        } else {
            appendLog(getPlayerColor(currentPlayer) + ' automatically passes for Knowledge Swap.');
            passShare();
        }
    }

    function share(informationIndex){
        var currentPlayerObject = players[currentPlayer];
        var chosenInfo = currentPlayerObject.informationPieces.splice(informationIndex, 1)[0];
        var mushroomType = chosenInfo.mushroomType;
        var currentMushroomBoard = mushroomBoards[mushroomType];
        currentMushroomBoard.sharedInformation.push(chosenInfo);
        currentPlayerObject.maxAvailableCrates += 1;
        currentPlayerObject.availableCrates = currentPlayerObject.maxAvailableCrates;
        appendLog(getPlayerColor(currentPlayer) + ' shares ' + getMushroomName(mushroomType) + ' is not worth ' + chosenInfo.pointValue + ' for Knowledge Swap and now has ' + currentPlayerObject.maxAvailableCrates + ' crates.');
        finishShare();
    }

    function passShare(){
        appendLog(getPlayerColor(currentPlayer) + ' passes for Knowledge Swap.');
        finishShare();
    }

    function finishShare(){
        getNextPlayer();
        refreshMushroomBoards();
        refreshPlayerBoards();
        if(startSharePlayer == currentPlayer){
            if(players.length == 2 && informationFlipDeck.informationPieces.length > 0){
                var infoToFlip = informationFlipDeck.informationPieces.splice(0, 1)[0];
                var currentMushroomBoard = mushroomBoards[infoToFlip.mushroomType];
                currentMushroomBoard.sharedInformation.push(infoToFlip);
                appendLog('The deck automatically shares ' + getMushroomName(infoToFlip.mushroomType) + ' is not worth ' + infoToFlip.pointValue + ' for Knowledge Swap.');
                refreshMushroomBoards();
            }
            //Start next harvest phase
            firstPlayer += 1;
            if(firstPlayer >= players.length){
                firstPlayer = 0;
            }
            appendLog('The first player will be ' + getPlayerColor(firstPlayer) + '.');
            currentPlayer = firstPlayer;
            refreshPlayerBoards();
            showTurn();
            appendLog('Picking Mushrooms Phase.');
            showActions();
        } else {
            showShareOptions();
        }
    }

    function showWinners(maxScore, maxCount){
        appendLog('The winners are:');
        var winnerString = '<div>Game Phase: End Game</div>';
        winnerString += '<div>Score: ' + maxScore +'</div>'
        winnerString += '<div>Mushroom Count: ' + maxCount +'</div>'
        for(var i = 0; i < winners.length; i++){
            var winner = winners[i];
            winnerString += '<div>Winner: ' + getPlayerColor(winner)+'</div>';
            appendLog(getPlayerColor(winner));
        }
        $('#winners').html(winnerString);
    }

    function refreshPeak(){
        var peakString = '';
        var playerInfo = players[currentPlayer].informationPieces;
        for(var i = 0; i < playerInfo.length; i++) {
            peakString += '<div>Mushroom Type: '+getMushroomName(playerInfo[i].mushroomType)+' Point Value: '+playerInfo[i].pointValue+'<div>'
        }
        $("#peak").html(peakString);
    }

    function clearCrates(){
        for(var i = 0; i < mushroomBoards.length; i++){
            var currentMushroomBoard = mushroomBoards[i];
            currentMushroomBoard.crates = [null, null, null, null, null];
        }
        for(var j = 0; j < players.length; j++){
            var playerObject = players[j];
            playerObject.availableCrates = playerObject.maxAvailableCrates;
            playerObject.skipped = false;
        }
    }

    function getBonus(){
        for(var i = 0; i < mushroomBoards.length; i++){
            var totalCrates = [];
            for(var j = 0; j < players.length; j++){
                totalCrates.push(0);
            }
            var currentMushroomBoard = mushroomBoards[i];
            if(currentMushroomBoard.mushroomQuantity > 0){
                for(var k = 0; k < currentMushroomBoard.crates.length; k++){
                    var cratePlayer = currentMushroomBoard.crates[k];
                    if(cratePlayer != null){
                        totalCrates[cratePlayer] += getCrateCost(k);
                    }
                }
                var mostPlayer = null;
                var mostValue = 0;
                for(var l = 0; l < totalCrates.length; l++){
                    if(totalCrates[l] > mostValue){
                        mostValue = totalCrates[l];
                        mostPlayer = l;
                    } else if(totalCrates[l] == mostValue){
                        mostPlayer = null;
                    }
                }
                if(mostPlayer != null){
                    currentMushroomBoard.mushroomQuantity -= 1;
                    players[mostPlayer].mushrooms[i] += 1;
                    appendLog(getPlayerColor(mostPlayer) + ' gets a bonus ' + getMushroomName(i) + '.');
                }
            }
        }
    }

    function putCratesOnMushroomBoard(inMushroomBoard, playerIndex){
        for(var i = 0; i < inMushroomBoard.crates.length; i++){
            var cratePlayer = inMushroomBoard.crates[i];
            if(cratePlayer == null){
                inMushroomBoard.crates[i] = playerIndex;
                return;
            }
        }
    }

    function unpeak(){
        $("#peak").html('');
    }

    function showSecretsActions(){
        $('#secrets').html('<input style="margin: 5px;" id="peakbutton" type="button" value="Peak" onmousedown="refreshPeak()" onmouseup="unpeak()" onmouseout="unpeak()">');
    }
    
</script>
<div id="title">Awe Thicket - Mushroom Harvesting Board Game</div>
<div id="setup">
    <form>
        <input type="button" style="margin: 5px;" value="2 Players" onclick="choosePlayers(2);">
        <input type="button" style="margin: 5px;" value="3 Players" onclick="choosePlayers(3);">
        <input type="button" style="margin: 5px;" value="4 Players" onclick="choosePlayers(4);">
        <input type="button" style="margin: 5px;" value="5 Players" onclick="choosePlayers(5);">
    </form>
</div>
<div id="mushroomBoards"></div>
<div id="playerBoards"></div>
<div id="current"></div>
<div id="actions"><div>Game Phase: Pick number of players</div></div>
<div id="gameHistory"></div>
<div id="secrets"></div>
<div id="peak" style="height: 100px;"></div>
<div id="winners"></div>
<div id="gamelog"><textarea id="gamelogtext" readonly style="width: 400px; height: 400px;"></textarea></div>
<style id="customAnimation">
</style>
<div>Feedback: ccarrster@gmail.com <a href="http://chriscarr.name" target="_blank">About Developer</a> <a href="https://github.com/ccarrster/awethicket" target="_blank">Source Code</a> </div>
</body>
</html>